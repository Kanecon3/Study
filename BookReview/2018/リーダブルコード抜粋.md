# リーダブルコード要約

## 読みやすさの基本定理

コードは他の人が最短時間で理解できるように書かなければならない。

## 明確な単語を選ぶ

### 目的に適した明確な名前をつける

**例**:

```text
GetPage(url) {}
```

「get」という単語からは何も伝わってこない。
このメソッドはページをどこから取ってくるのだろう？
ローカルキャッシュから？DBから？インターネットから？

## tmpやretvalなどの汎用的な名前を避ける

- ただし、明確な理由があれば話は別
- イテレータが複数あるときには、インデックスにもっと明確な名前をつけるといい

**例**:

```text
// 間違えているが見つけ辛い
for (int i = 0; i < clubs.size(); i++)
    for (int j = 0; j < clubs[i].members.size(); j++)
        for (int k = 0; k < users.size(); k++)
            if (clubs[i].members[k] == users[j])

// 改善後
for (int ci = 0; ci < clubs.size(); ci++)
    for (int mj = 0; mj < clubs[i].members.size(); mj++)
        for (int uk = 0; uk < users.size(); uk++)
            if (clubs[ci].members[uk] == users[mj])  // バグだ！最初の文字が違ってる！
```

## 抽象的な名前よりも具体的な名前を使う

- 直交する概念は無理に1つにまとめようとせずに、別々に使えるようにするといい（コンパイルオプション、環境変数なども）

## 名前に情報を追加する

- 変数に値の単位をつける

**例**:

```text
delay → delay_secs
size → size_mb
```

## 名前の長さを決める

- スコープが小さければ短い名前でもいい

**例**:

```text
if (debug) {
    map<string,int> m;
    LookUpNamesNumbers(&m);
    Print(m);
}
```

`m` という変数名にはあまり情報が含まれていない。でも、大丈夫。
コードを理解するのに必要な情報がすぐそばにあるからだ。
しかし、`m` がクラスのメンバ変数やグローバル変数ならどうだろう？

### 頭文字と省略形

クラス名を`BackEndManager`じゃなくて`BEManager`にしたりするプロジェクト固有の省略形はダメだ。
新しくプロジェクトに参加した人は、暗号みたいに見えて怖いと思うだろう。
新しいチームメイトはその名前の意味を理解できるだろうか？

### 大文字やアンダースコアなどに意味を含める

たとえば、クラスのメンバ変数にアンダースコアをつけて、ローカル変数と区別する。

## 誤解されない名前

- 名前が「他の意味と間違えられることはないだろうか？」と何度も自問自答する
  積極的に「誤解」を探していく

### 範囲を指定するときはfirstとlastを使う

```text
first    last   
↓       ↓     
[a][b][c][d][ ] 
```

### 包含／排他的範囲にはbeginとendを使う

```text
begin       end 
↓          ↓  
[a][b][c][d][ ] 
```

### disable_sslのような否定形は避ける

## 美しさ

複数のコードブロックで同じようなことをしていたら、シルエットも同じようなものにする。

## コメントすべきことを知る

### コードを書いているときの自分の考えを記録する

なぜコードが他のやり方ではなくこうなっているのか。

映画のDVDにはよく「監督のコメンタリー」がついてくる。
映画の製作者が自分の考えや物語について語ってくれるので、
作品がどのように作られたのかを理解するのに役立つ。

### コードの欠陥にコメントをつける

コードは絶えず進化しているので、その過程で欠陥を生む運命にある。
その欠陥を文書化することを恥ずかしがってはいけない。

コードが未完成のときは、以下のように書いておこう。
プログラマがよく使う記法がいくつかある。

- `TODO:`  あとで手をつける
- `FIXME:` 既知の不具合があるコード
- `HACK:`  あまりキレイじゃない解決策
- `XXX:`   危険！大きな問題がある

### 定数にコメントをつける

なかには名前が明確なのでコメントが必要ない定数もあるが、
定数の値を決めたときに頭のなかで考えていたことを記録することが大切なのだ。

### その他のコメントのポイント

- 質問されそうなことを想像する
- ハマりそうな罠を告知する
- 読み手が細部に捕らわれないように、コードブロックにコメントをつけて概要をまとめる

## コメントは正確で簡潔に

### 複数のものを指す可能性がある「それ」や「これ」などの代名詞を避ける

**例**:

```text
// データをキャッシュに入れる。ただし、先にそのサイズをチェックする
```

↑「そのサイズ」の「その」は何を指しているの？

### コードの意図を書く

コードの動作をそのまま書いているだけで、何も情報を追加していないコメントが多い。
詳細レベルではなく、高レベルで記述する。

## 制御フローを読みやすくする

### 条件式の引数の並び順

- 左側：「調査対象」の式。変化する
- 右側：「比較対象」の式。あまり変化しない

**例**:

```text
○ if (length >= 10)
× if (10 <= length)
```

### if/elseブロックの並び順

- 単純な条件を先に
- 条件は否定形よりも肯定形を使う
  たとえば、`if (!debug)` ではなく、`if(debug)` を使う

### 三項演算子（条件?a:b）

基本的にはif/elseを使おう。三項演算子はそれによって簡潔になるときにだけ使おう。

### ネストを浅くする

## 巨大な式を分割する

### 「説明変数」を使う

**例**:

```text
# Before
if line.split(':')[0].strip() == "root":
    ...

# After
username = line.split(':')[0].strip()
if username == "root":
    ...
```

### 短絡評価の悪用

たとえば、`if (a || b)` の `a` が `true` なら、`b` は評価されない。
この動作はすごく便利だけど、悪用すると複雑なロジックになってしまう。

**例**:

```text
// Before
assert((!(bucket = FindBucket(key))) || !bucket->IsOccupied());

// After - この方が理解しやすい
bucket = FindBucket(key);
if (bucket != NULL) assert(!bucket->IsOccupied());
```

「（このコードを書いた）自分は頭がいい！」みたいなコードに気を付ける。
あとで他の人がコードを読むときにわかりにくくなる。

## 変数を削除する

### 役に立たない一時変数を削除

**例**:

```text
# Before
now = datetime.datetime.now()
root_message.last_view_time = now

# After - nowがなくても楽に理解できる
root_message.last_view_time = datetime.datetime.now()
```

### 中間結果を削除する

**例**:

```text
// Before
var remove_one = function (array, value_to_remove) {
    var index_to_remove = null;
    for (var i = 0; i < array.length; i += 1) {
        if (array[i] === value_to_remove) {
            index_to_remove = i;
            break;
        }
    }

    if (index_to_remove !== null) {
        array.splice(index_to_remove, 1);
    }
};

// After
var remove_one = function (array, value_to_remove) {
    for (var i = 0; i < array.length; i += 1) {
        if (array[i] === value_to_remove) {
            array.splice(i, 1);
            return;
        }
    }
};
```

関数から早く返すことで、コードがずっと簡潔になった。

## 変数のスコープを縮める

変数を数行のコードからしか見えない位置に移動する。

## 無関係の下位問題を抽出する

プロジェクト固有のコードから汎用コードを分離する。

## 一度に1つの事を

一度に複数のことをするコードは理解しにくい。

## コードに思いを込める

コードの動作を、簡単な言葉で同僚にもわかるように説明する。
その説明に合わせてコードを書く。

## コードを小さくたもつ

- 不必要な機能をプロダクトから削除する。過剰な機能は持たせない
- 未使用のコードや無用の機能を削除する
- ライブラリを知る
  - プログラマというのは、既存のライブラリで問題を解決できることを知らないことが多い
  - たまには標準ライブラリのすべての関数・モジュール・型の名前を15分かけて読んでみよう

## 最後に

Aさん「自分が書いたコードってどのくらい覚えているんですか？」  
Bさん「ほとんど覚えていないですよ。」  
Aさん「直すときどうするんですか？わからなくなってるじゃないですか。」  
Bさん「忘れても見たら簡単にわかるように書いておくんですよ。」  
